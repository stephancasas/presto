"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))((function(o,n){function u(e){try{s(i.next(e))}catch(e){n(e)}}function a(e){try{s(i.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}s((i=i.apply(e,t||[])).next())}))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.loadConfigFile=void 0;const fs=require("fs"),path=require("path"),url_1=require("url"),babel=require("@babel/core"),utils_1=require("./utils");function supportsNativeESM(){return Number(/^v(\d+)/.exec(process.version)[1])>=13}function loadConfigFile(e,t){return __awaiter(this,void 0,void 0,(function*(){const r=utils_1.absolutePath(e),i=path.extname(r);return".mjs"===i&&supportsNativeESM()?(yield Promise.resolve().then(()=>require(url_1.pathToFileURL(r).href))).default:".cjs"===i?getDefaultFromCjs(require(r)):yield getDefaultFromTranspiledConfigFile(r,t.silent)}))}function getDefaultFromCjs(e){return e.__esModule?e.default:e}function getDefaultFromTranspiledConfigFile(e,t){return __awaiter(this,void 0,void 0,(function*(){const t=fs.readFileSync(fs.realpathSync(e),{encoding:"utf-8"}),r=babel.transform(t,{presets:["@babel/preset-env"]}).code;return loadConfigFromBundledFile(e,r)}))}function loadConfigFromBundledFile(e,t){return __awaiter(this,void 0,void 0,(function*(){const r=fs.realpathSync(e),i=path.extname(r),o=require.extensions[i];require.extensions[i]=(e,i)=>{i===r?e._compile(t,i):o(e,i)},delete require.cache[r];try{const t=getDefaultFromCjs(require(e));return require.extensions[i]=o,t}catch(e){throw console.log("Failed to load ES module from CommonJS. This is not supported."),e}}))}exports.loadConfigFile=loadConfigFile;