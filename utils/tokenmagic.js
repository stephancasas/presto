"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.implementMagicAttrs=exports.hasHtmlTokens=exports.resolveTokenContext=exports.resolveTokenCoordinates=exports.specialAttrs=exports.unsafeChars=void 0;const utils_1=require("./utils"),cheerio=require("cheerio"),edge_lexer_1=require("edge-lexer");function resolveTokenCoordinates(e,t){const{line:s,col:r}=t.loc.start;return utils_1.resolveCharCoordinates(e,s,r)}function resolveTokenContext(e,t){const s=resolveTokenCoordinates(e,t);return utils_1.resolveCharContext(e,s)}function hasHtmlTokens(e){const t=new edge_lexer_1.Tokenizer(e,{},{filename:""});t.parse();const s=t.tokens.filter(e=>"mustache"===e.type);let r=!1;return s.map(t=>{const s=resolveTokenContext(e,t);r||(r="html"===s.rel)}),r}function implementMagicAttrs(e){const t=cheerio.load(e);t("*[snowblade-magic]").each((e,s)=>{Object.keys(s.attribs).map(e=>{let r=s.attribs[e];if(r.indexOf("snowblade-magic")<0)return;r=r.replace(/\ssnowblade-magic/g,""),"`"!==r.substr(0,1)&&"`"!==r.substr(-1)&&(r="`"+r+"`");let o=exports.specialAttrs.filter(t=>e.indexOf(t.attr)>=0);const a=o.length>0?o[0].sub.length>0?o[0].sub:e:"x-bind:"+e;t(s).removeAttr(e);let n={};n[a]=r,t(s).attr(n)})});let s=t.html();return exports.unsafeChars.map(e=>{const t=new RegExp(e.sub,"g");s=s.replace(t,e.safe)}),s=s.replace(/snowblade-magic\s/g,""),s=s.replace(/snowblade-magic\=""\s/g,""),s}exports.unsafeChars=[{char:"=",sub:"snowblade-equals",safe:"&equals;"},{char:'"',sub:"snowblade-quote",safe:"&quot;"},{char:"<",sub:"snowblade-lessthan",safe:"&lt;"},{char:">",sub:"snowblade-greaterthan",safe:"&gt;"},{char:"`",sub:"snowblade-backtick",safe:"\\`"}],exports.specialAttrs=[{attr:"x-html",sub:""},{attr:"x-bind",sub:""},{attr:"value",sub:"x-model"},{attr:"x-model",sub:""},{attr:"x-text",sub:""}],exports.resolveTokenCoordinates=resolveTokenCoordinates,exports.resolveTokenContext=resolveTokenContext,exports.hasHtmlTokens=hasHtmlTokens,exports.implementMagicAttrs=implementMagicAttrs;